import type { Metadata } from "next";
import "./styles/globals.css";
import ReactQueryProvider from "./providers/QueryProvider";
import { Header } from "@/widgets/header/Header";
import { getUserServer } from "@/shared/libs/auth/getCurrentUser";
import { dehydrate, QueryClient } from "@tanstack/react-query";
import { queryKeys } from "@/shared/keys/query-keys";
import { AppThemeProvider } from "./providers/ThemeProvider";
import { RestaurantProvider } from "./providers/RestaurantContext";
import { Sidebar } from "@/widgets/(admin)/dashboard/Sidebar";

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  async function getUser() {
    const queryClient = new QueryClient();

    try {
      await queryClient.prefetchQuery({
        queryKey: queryKeys.user.me(),
        queryFn: getUserServer,
      });

      const dehydratedState = dehydrate(queryClient);
      return dehydratedState;
    } catch (error) {
      return undefined;
    }
  }

  const dehydratedState = await getUser();
  const user = dehydratedState?.queries[0].state.data;
  console.log("user lay", dehydratedState?.queries[0].state.data);

  return (
    <html lang="en">
      {/* نستخدم h-screen لمنع السكرول في الجسم الرئيسي، و flex لتوزيع العناصر */}
      <body className=" h-screen overflow-hidden bg-gray-100">
        <ReactQueryProvider dehydratedState={dehydratedState}>
          <AppThemeProvider>{children}</AppThemeProvider>
        </ReactQueryProvider>
      </body>
    </html>
  );
}
